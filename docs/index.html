<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Status</title>
</head>
<body>
  <h1>Form Status</h1>

  <script>

    fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("https://shehryartariq1.github.io/form-status-monitor/status.json"))
  .then(res => {
    if (!res.ok) {
      console.error(`HTTP error! status: ${res.status}`);
      throw new Error(`HTTP error! status: ${res.status}`);
    }
    return res.json();
  })
  .then(data => {
    if (data && data.contents) {
      try {
        const jsonData = JSON.parse(data.contents);
        console.log("Fetched data:", jsonData);

        if (!jsonData) {
          alert("Error: Parsed data is empty.");
          return;
        }

        const banner = document.createElement("div");
        banner.style.cssText = `
          padding: 12px;
          font-weight: bold;
          text-align: center;
          font-family: sans-serif;
        `;

        if (jsonData.formStatus === "down") {
          banner.textContent = "⚠️ Some forms are temporarily unavailable.";
          banner.style.backgroundColor = "#ffdddd";
          banner.style.color = "#a00";
        } else {
          banner.textContent = "✅ All forms are currently working.";
          banner.style.backgroundColor = "#e6ffea";
          banner.style.color = "#007b33";
        }

        const formDetails = document.createElement("ul");
        jsonData.allForms.forEach(form => {
          const li = document.createElement("li");
          li.textContent = `${form.name}: ${form.status === "up" ? "✅ Up" : "⚠️ Down"}`;
          formDetails.appendChild(li);
        });

        document.body.prepend(banner);
        document.body.appendChild(formDetails);

      } catch (parseError) {
        console.error("Error parsing JSON content:", parseError, data.contents);
        alert("Error parsing the fetched data.");
      }
    } else {
      console.error("Error: Invalid response structure from CORS proxy:", data);
      alert("Error: Could not retrieve data from the server.");
    }
  })
  .catch(error => {
    console.error("Error fetching form status:", error);
    alert("There was an error fetching the form status.");
  });
   
  </script>
</body>
</html>
