fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("https://shehryartariq1.github.io/form-status-monitor/status.json"))
  .then(res => {
    if (!res.ok) {
      console.error(`HTTP error! status: ${res.status}`);
      throw new Error(`HTTP error! status: ${res.status}`);
    }
    return res.json();
  })
  .then(data => {
    if (data && data.contents) {
      try {
        const jsonData = JSON.parse(data.contents);
        console.log("Fetched data:", jsonData);

        if (!jsonData || !jsonData.allForms || jsonData.allForms.length === 0) {
          alert("Error: No form data available.");
          return;
        }

        const banner = document.createElement("div");
        banner.style.cssText = `
          padding: 12px;
          font-weight: bold;
          text-align: center;
          font-family: sans-serif;
        `;

        // Check the status of both forms
        const contactFormUp = jsonData.allForms.some(form => form.name === "Contact Form" && form.status === "up");
        const registrationFormUp = jsonData.allForms.some(form => form.name === "Registration Form" && form.status === "up");

        if (contactFormUp && registrationFormUp) {
          banner.textContent = "✅ All forms are currently working.";
          banner.style.backgroundColor = "#e6ffea";
          banner.style.color = "#007b33";
        } else {
          banner.textContent = "⚠️ Some forms are temporarily unavailable.";
          banner.style.backgroundColor = "#ffdddd";
          banner.style.color = "#a00";
        }

        const formDetails = document.createElement("ul");
        jsonData.allForms.forEach(form => {
          const li = document.createElement("li");
          li.textContent = `${form.name}: ${form.status === "up" ? "✅ Up" : "⚠️ Down"}`;
          formDetails.appendChild(li);
        });

        document.body.prepend(banner);
        document.body.appendChild(formDetails);

      } catch (parseError) {
        console.error("Error parsing JSON content:", parseError, data.contents);
        alert("Error parsing the fetched data.");
      }
    } else {
      console.error("Error: Invalid response structure from CORS proxy:", data);
      alert("Error: Could not retrieve data from the server.");
    }
  })
  .catch(error => {
    console.error("Error fetching form status:", error);
    alert("There was an error fetching the form status.");
  });
